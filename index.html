<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kameradan Barkod Tarama ve Stok Numarası Bulma</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 50px;
        }
        #video-preview {
            width: 100%;
            max-width: 600px;
            margin: auto;
            margin-bottom: 20px;
        }
        #result {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h2>Kameradan Barkod Tarama ve Stok Numarası Bulma</h2>
    <video id="video-preview"></video>
    <div id="result"></div>

    <script src="https://cdn.jsdelivr.net/npm/@zxing/library@3.0.1/build/zxing.min.js"></script>
    <script>
        // Kamera üzerinden barkod tarama işlemini başlatan fonksiyon
        async function startScanning() {
            const codeReader = new ZXing.BrowserQRCodeReader(); // veya BrowserBarcodeReader() kullanarak QR ve diğer barkod türlerini tara

            try {
                const videoInputDevices = await codeReader.getVideoInputDevices();
                const selectedDeviceId = videoInputDevices[0].deviceId; // ilk video cihazını kullanır

                const constraints = {
                    video: {
                        deviceId: selectedDeviceId ? { exact: selectedDeviceId } : undefined
                    }
                };

                const stream = await navigator.mediaDevices.getUserMedia(constraints);
                document.getElementById('video-preview').srcObject = stream;

                codeReader.decodeFromVideoDevice(selectedDeviceId, 'video-preview', (result, err) => {
                    if (result) {
                        console.log(result.text);
                        findStockNumber(result.text);
                        codeReader.reset(); // taramayı durdur
                    }
                    if (err && !(err instanceof ZXing.NotFoundException)) {
                        console.error(err);
                    }
                });
            } catch (err) {
                console.error(err);
            }
        }

        function findStockNumber(barcode) {
            // Burada basit bir örnek, gerçek bir veritabanı veya API'den stok numarası almak gerekir
            // Örneğin, EAN-13'in ilk 7 hanesi üretici ya da firma kodunu temsil eder
            var manufacturerCode = barcode.substring(1, 7); // Örneğin: 699536

            var stockNumber = "STOK-" + manufacturerCode;

            // Sonucu ekranda göster
            document.getElementById('result').innerHTML = "<p>Stok Numarası: " + stockNumber + "</p>";
        }

        // Taramayı başlat
        startScanning();
    </script>
</body>
</html>
